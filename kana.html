<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>äº”åéŸ³è½åŠ›ç·´ç¿’å™¨ - æœ€çµ‚ç‰ˆ</title>
    <style>
      :root {
        --primary: #6366f1;
        --secondary: #10b981;
        --bg: #f8fafc;
      }
      body {
        font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0;
        background-color: var(--bg);
        color: #1e293b;
      }
      .container {
        background: white;
        padding: 2.5rem;
        border-radius: 24px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        text-align: center;
        width: 420px;
      }
      .settings {
        background: #f1f5f9;
        padding: 15px;
        border-radius: 16px;
        margin-bottom: 20px;
        text-align: left;
      }
      .setting-item {
        margin-bottom: 12px;
      }
      label {
        font-size: 13px;
        font-weight: 600;
        color: #64748b;
        display: flex;
        justify-content: space-between;
      }
      select,
      input[type="range"] {
        width: 100%;
        margin-top: 5px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        box-sizing: border-box;
        font-size: 13px;
      }
      #display {
        font-size: 60px;
        font-weight: bold;
        height: 160px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #e2e8f0;
        margin: 10px 0;
        background: #fafafa;
        border-radius: 12px;
      }
      #statusText {
        font-size: 16px;
        color: #94a3b8;
        height: 24px;
        margin-bottom: 10px;
      }
      .button-group {
        display: flex;
        gap: 12px;
      }
      #drawBtn {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 20px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 12px;
        cursor: pointer;
        flex: 3;
        transition: all 0.2s;
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
      }
      #replayBtn {
        background-color: var(--secondary);
        color: white;
        border: none;
        padding: 20px;
        font-size: 22px;
        font-weight: bold;
        border-radius: 12px;
        cursor: pointer;
        flex: 1;
        transition: all 0.2s;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      button:active {
        transform: scale(0.96);
      }
      .kb-hint {
        margin-top: 20px;
        font-size: 12px;
        color: #94a3b8;
        line-height: 1.6;
      }
      kbd {
        background: #eee;
        padding: 2px 4px;
        border-radius: 4px;
        color: #555;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="settings">
        <div class="setting-item">
          <label>èªéŸ³è§’è‰²:</label>
          <select id="voiceSelect">
            <option>è¼‰å…¥èªéŸ³ä¸­...</option>
          </select>
        </div>

        <div class="setting-item">
          <label>æ­æ›‰å»¶é²: <span id="delayVal">4.0</span> ç§’</label>
          <input
            type="range"
            id="delayInput"
            min="0.5"
            max="10"
            step="0.5"
            value="4"
          />
        </div>

        <div class="setting-item">
          <label>èªé€Ÿ (Rate): <span id="rateVal">0.75</span></label>
          <input
            type="range"
            id="rateInput"
            min="0.5"
            max="1.5"
            step="0.05"
            value="0.75"
          />
        </div>
      </div>

      <div id="statusText">æº–å‚™å°±ç·’</div>
      <div id="display">?</div>

      <div class="button-group">
        <button id="drawBtn">æŠ½å‡ºç™¼éŸ³ (Space)</button>
        <button id="replayBtn" title="é‡è½ä¸€æ¬¡ (V)">ğŸ”Š</button>
      </div>

      <div class="kb-hint">
        æŒ‰ <kbd>Space</kbd> æŠ½æ–°é¡Œç›®ï½œæŒ‰ <kbd>V</kbd> é‡è½ç™¼éŸ³
      </div>
    </div>

    <script>
      const correctBasic = [
        ["ã‚", "ã‚¢"],
        ["ã„", "ã‚¤"],
        ["ã†", "ã‚¦"],
        ["ãˆ", "ã‚¨"],
        ["ãŠ", "ã‚ª"],
        ["ã‹", "ã‚«"],
        ["ã", "ã‚­"],
        ["ã", "ã‚¯"],
        ["ã‘", "ã‚±"],
        ["ã“", "ã‚³"],
        ["ã•", "ã‚µ"],
        ["ã—", "ã‚·"],
        ["ã™", "ã‚¹"],
        ["ã›", "ã‚»"],
        ["ã", "ã‚½"],
        ["ãŸ", "ã‚¿"],
        ["ã¡", "ãƒ"],
        ["ã¤", "ãƒ„"],
        ["ã¦", "ãƒ†"],
        ["ã¨", "ãƒˆ"],
        ["ãª", "ãƒŠ"],
        ["ã«", "ãƒ‹"],
        ["ã¬", "ãƒŒ"],
        ["ã­", "ãƒ"],
        ["ã®", "ãƒ"],
        ["ã¯", "ãƒ"],
        ["ã²", "ãƒ’"],
        ["ãµ", "ãƒ•"],
        ["ã¸", "ãƒ˜"],
        ["ã»", "ãƒ›"],
        ["ã¾", "ãƒ"],
        ["ã¿", "ãƒŸ"],
        ["ã‚€", "ãƒ "],
        ["ã‚", "ãƒ¡"],
        ["ã‚‚", "ãƒ¢"],
        ["ã‚„", "ãƒ¤"],
        ["ã‚†", "ãƒ¦"],
        ["ã‚ˆ", "ãƒ¨"],
        ["ã‚‰", "ãƒ©"],
        ["ã‚Š", "ãƒª"],
        ["ã‚‹", "ãƒ«"],
        ["ã‚Œ", "ãƒ¬"],
        ["ã‚", "ãƒ­"],
        ["ã‚", "ãƒ¯"],
        ["ã‚’", "ãƒ²"],
        ["ã‚“", "ãƒ³"],
        ["ãŒ", "ã‚¬"],
        ["ã", "ã‚®"],
        ["ã", "ã‚°"],
        ["ã’", "ã‚²"],
        ["ã”", "ã‚´"],
        ["ã–", "ã‚¶"],
        ["ã˜", "ã‚¸"],
        ["ãš", "ã‚º"],
        ["ãœ", "ã‚¼"],
        ["ã", "ã‚¾"],
        ["ã ", "ãƒ€"],
        ["ã¢", "ãƒ‚"],
        ["ã¥", "ãƒ…"],
        ["ã§", "ãƒ‡"],
        ["ã©", "ãƒ‰"],
        ["ã°", "ãƒ"],
        ["ã³", "ãƒ“"],
        ["ã¶", "ãƒ–"],
        ["ã¹", "ãƒ™"],
        ["ã¼", "ãƒœ"],
        ["ã±", "ãƒ‘"],
        ["ã´", "ãƒ”"],
        ["ã·", "ãƒ—"],
        ["ãº", "ãƒš"],
        ["ã½", "ãƒ"],
      ];
      const yoon = [
        ["ãã‚ƒ", "ã‚­ãƒ£"],
        ["ãã‚…", "ã‚­ãƒ¥"],
        ["ãã‚‡", "ã‚­ãƒ§"],
        ["ã—ã‚ƒ", "ã‚·ãƒ£"],
        ["ã—ã‚…", "ã‚·ãƒ¥"],
        ["ã—ã‚‡", "ã‚·ãƒ§"],
        ["ã¡ã‚ƒ", "ãƒãƒ£"],
        ["ã¡ã‚…", "ãƒãƒ¥"],
        ["ã¡ã‚‡", "ãƒãƒ§"],
        ["ã«ã‚ƒ", "ãƒ‹ãƒ£"],
        ["ã«ã‚…", "ãƒ‹ãƒ¥"],
        ["ã«ã‚‡", "ãƒ‹ãƒ§"],
        ["ã²ã‚ƒ", "ãƒ’ãƒ£"],
        ["ã²ã‚…", "ãƒ’ãƒ¥"],
        ["ã²ã‚‡", "ãƒ’ãƒ§"],
        ["ã¿ã‚ƒ", "ãƒŸãƒ£"],
        ["ã¿ã‚…", "ãƒŸãƒ¥"],
        ["ã¿ã‚‡", "ãƒŸãƒ§"],
        ["ã‚Šã‚ƒ", "ãƒªãƒ£"],
        ["ã‚Šã‚…", "ãƒªãƒ¥"],
        ["ã‚Šã‚‡", "ãƒªãƒ§"],
        ["ãã‚ƒ", "ã‚®ãƒ£"],
        ["ãã‚…", "ã‚®ãƒ¥"],
        ["ãã‚‡", "ã‚®ãƒ§"],
        ["ã˜ã‚ƒ", "ã‚¸ãƒ£"],
        ["ã˜ã‚…", "ã‚¸ãƒ¥"],
        ["ã˜ã‚‡", "ã‚¸ãƒ§"],
        ["ã³ã‚ƒ", "ãƒ“ãƒ£"],
        ["ã³ã‚…", "ãƒ“ãƒ¥"],
        ["ã³ã‚‡", "ãƒ“ãƒ§"],
        ["ã´ã‚ƒ", "ãƒ”ãƒ£"],
        ["ã´ã‚…", "ãƒ”ãƒ¥"],
        ["ã´ã‚‡", "ãƒ”ãƒ§"],
      ];
      const chÅon = [
        ["ã‹ã‚", "ã‚«ãƒ¼"],
        ["ãã„", "ã‚­ãƒ¼"],
        ["ãã†", "ã‚¯ãƒ¼"],
        ["ã‘ãˆ", "ã‚±ãƒ¼"],
        ["ã“ã†", "ã‚³ãƒ¼"],
        ["ã•ã‚", "ã‚µãƒ¼"],
        ["ã—ã„", "ã‚·ãƒ¼"],
        ["ã™ã†", "ã‚¹ãƒ¼"],
        ["ã›ãˆ", "ã‚»ãƒ¼"],
        ["ãã†", "ã‚½ãƒ¼"],
        ["ã‚ã‚", "ã‚¢ãƒ¼"],
        ["ã„ã„", "ã‚¤ãƒ¼"],
        ["ã†ã†", "ã‚¦ãƒ¼"],
        ["ãˆãˆ", "ã‚¨ãƒ¼"],
        ["ãŠã†", "ã‚ªãƒ¼"],
      ];

      const allKana = [...correctBasic, ...yoon, ...chÅon];
      const voiceSelect = document.getElementById("voiceSelect");
      const display = document.getElementById("display");
      const statusText = document.getElementById("statusText");
      const drawBtn = document.getElementById("drawBtn");
      const replayBtn = document.getElementById("replayBtn");
      const delayInput = document.getElementById("delayInput");
      const delayVal = document.getElementById("delayVal");
      const rateInput = document.getElementById("rateInput");
      const rateVal = document.getElementById("rateVal");

      let voices = [];
      let timer = null;
      let currentWord = "";

      function loadVoices() {
        voices = window.speechSynthesis.getVoices();
        const jpVoices = voices.filter((v) => v.lang.includes("ja"));

        voiceSelect.innerHTML = "";
        if (jpVoices.length === 0) {
          voiceSelect.innerHTML = "<option>æ‰¾ä¸åˆ°æ—¥æ–‡èªéŸ³</option>";
          return;
        }

        jpVoices.forEach((voice) => {
          const option = document.createElement("option");
          option.textContent = voice.name;
          option.value = voice.name;
          voiceSelect.appendChild(option);
        });

        // æ ¸å¿ƒä¿®æ”¹ï¼šé è¨­é¸æ“‡æ¸…å–®ä¸­çš„æœ€å¾Œä¸€å€‹
        voiceSelect.selectedIndex = jpVoices.length - 1;
      }

      // è™•ç†éƒ¨åˆ†ç€è¦½å™¨éåŒæ­¥åŠ è¼‰èªéŸ³çš„å•é¡Œ
      if (window.speechSynthesis.onvoiceschanged !== undefined) {
        window.speechSynthesis.onvoiceschanged = loadVoices;
      }
      loadVoices();

      function speak(text) {
        if (!text) return;
        const utter = new SpeechSynthesisUtterance(text);
        const selectedVoice = voices.find((v) => v.name === voiceSelect.value);
        if (selectedVoice) utter.voice = selectedVoice;
        utter.lang = "ja-JP";
        utter.rate = parseFloat(rateInput.value);
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(utter);
      }

      delayInput.oninput = () =>
        (delayVal.innerText = parseFloat(delayInput.value).toFixed(1));
      rateInput.oninput = () =>
        (rateVal.innerText = parseFloat(rateInput.value).toFixed(2));

      function draw() {
        if (timer) clearTimeout(timer);
        const pair = allKana[Math.floor(Math.random() * allKana.length)];
        currentWord = pair[0];

        display.innerText = "ï¼Ÿ";
        display.style.color = "#e2e8f0";
        statusText.innerText = "è½éŸ³è¾¨è­˜ä¸­...";

        speak(currentWord);

        timer = setTimeout(() => {
          display.innerHTML = `<span style="color:#1e293b">${pair[0]}</span> <span style="font-size:30px; color:#cbd5e1; margin:0 10px;">/</span> <span style="color:#1e293b">${pair[1]}</span>`;
          statusText.innerText = "ç­”æ¡ˆæ­æ›‰";
        }, parseFloat(delayInput.value) * 1000);
      }

      drawBtn.onclick = draw;
      replayBtn.onclick = () => speak(currentWord);

      window.addEventListener("keydown", (e) => {
        if (e.code === "Space") {
          e.preventDefault();
          draw();
        }
        if (e.code === "KeyV") {
          speak(currentWord);
        }
      });
    </script>
  </body>
</html>
